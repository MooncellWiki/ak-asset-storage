enum status {
	working
	ready
}

Table bundles {
	id integer [ pk, increment, not null, unique ]
	path varchar [ not null ]
	version integer [ not null ]
	file integer [ not null, note: 'sha-256' ]

	indexes {
		(path, version) [ name: 'files_index_0' unique ]
	}
}

Table versions {
	id integer [ pk, increment, not null, unique ]
	res varchar [ not null, note: 'like 24-09-23-11-27-19-c6564b' ]
	client varchar [ not null, note: 'like 2.3.61' ]
	is_ready boolean [ not null ]
	hot_update_list text [ not null ]
}

Table files {
	id integer [ pk, increment, not null, unique ]
	hash char [ not null, unique ]
	size integer [ not null ]

	indexes {
		(key, value, file_id) [ name: 'file_metas_index_0' unique ]
	}
}

Table assets {
	id integer [ pk, increment, not null, unique ]
	file integer [ not null ]
	path varchar [ not null ]
	version integer [ not null ]
}

Table unpack_versions {
	id integer [ pk, increment, not null, unique ]
	bundle_version integer [ not null ]
	start_time timestamp [ not null, default: CURRENT_TIMESTAMP ]
	end_time timestamp
	token integer [ not null ]
}

Table unpack_relation {
	id integer [ pk, increment, not null, unique ]
	asset integer [ not null ]
	bundle integer [ not null ]

	indexes {
		(asset, bundle) [ name: 'unpack_relation_index_0' unique ]
	}
}

Table tokens {
	id integer [ pk, increment, not null, unique ]
	name char [ not null ]
	token char [ not null, note: '64长的hex' ]
}

Ref files_version_fk {
	bundles.version > versions.id [ delete: no action, update: no action ]
}

Ref files_id_fk {
	files.id < bundles.file [ delete: no action, update: no action ]
}

Ref assets_file_fk {
	assets.file > files.id [ delete: no action, update: no action ]
}

Ref unpack_version_version_fk {
	unpack_versions.bundle_version > versions.id [ delete: no action, update: no action ]
}

Ref assets_version_fk {
	assets.version > unpack_versions.id [ delete: no action, update: no action ]
}

Ref unpack_relation_asset_fk {
	unpack_relation.asset - assets.id [ delete: cascade, update: no action ]
}

Ref unpack_relation_bundle_fk {
	unpack_relation.bundle - bundles.id [ delete: cascade, update: no action ]
}

Ref fk_unpack_version_token_tokens {
	unpack_versions.token - tokens.id [ delete: no action, update: no action ]
}